(()=>{var o=class extends HTMLElement{$search=document.createElement("searchable-select-container");$input=this.querySelector("input")??document.createElement("INPUT");$select=this.querySelector("select");$results=document.createElement("DIV");options=[];constructor(){super(),this.observeOptions(),this.render(),this.renderResults()}static get observedAttributes(){return["placeholder","aria-label"]}attributeChangedCallback(e,t,s){this.$input.setAttribute(e,s)}observeOptions(){new MutationObserver(()=>{this.setDefault(),this.renderResults()}).observe(this.$select,{childList:!0})}render(){this.setDefault(),this.buildSearch(),this.bootEvents()}buildSearch(){this.$search.appendChild(this.$input),this.$results.classList.add("results"),this.$results.setAttribute("hidden",""),this.$search.appendChild(this.$results),this.prepend(this.$search)}select(e){let t=this.$results.querySelector("[data-selected]");t?.removeAttribute("data-selected"),t?.removeAttribute("data-hover"),e.setAttribute("data-selected",""),e.setAttribute("data-hover",""),this.$input.value=e.textContent,this.querySelector("option[selected]")?.removeAttribute("selected"),this.querySelector(`option[value='${e.dataset.value}']`).setAttribute("selected",""),this.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))}bootEvents(){this.$search.addEventListener("click",()=>{this.$results.toggleAttribute("hidden"),this.$results.querySelector("[data-selected]")?.scrollIntoView()}),this.$results.addEventListener("click",t=>{this.select(t.target)});let e=this.handleKeyoard.bind(this);this.$input.addEventListener("input",({target:{value:t}})=>{this.renderResults(t)}),this.$input.addEventListener("focus",()=>{this.$input.addEventListener("keydown",e)}),this.$input.addEventListener("blur",()=>{this.$input.removeEventListener("keydown",e)})}renderResults(e=""){let t=Array.from(this.querySelectorAll("option")),s=[],r;for(let i of t){if(e!==""&&!i.textContent.toLowerCase().includes(e.trim().toLowerCase()))continue;if(i.value===""){i.selected&&(r=!0);continue}let n=document.createElement("DIV");n.textContent=i.textContent,n.dataset.value=i.value,n.classList.add("result"),i.selected&&(n.setAttribute("data-selected",""),n.setAttribute("data-hover","")),s.push(n)}r&&s[0]?.setAttribute("data-hover",""),this.$results.replaceChildren(...s)}setDefault(){let e=this.querySelector("option[selected]");if(e)this.$input.value=e.textContent;else{let t=document.createElement("option");t.setAttribute("selected",""),this.$select.prepend(t)}}updateHover(e){this.$results.querySelector("[data-hover]")?.removeAttribute("data-hover"),e?.setAttribute("data-hover","")}handleKeyoard(e){let t=this.$results.querySelector("[data-hover]");if(t)switch(e.key){case"ArrowDown":e.preventDefault();let s=t.nextElementSibling;if(!s)return;this.updateHover(s),t.scrollIntoView();break;case"ArrowUp":e.preventDefault();let r=t.previousElementSibling;if(!r)return;this.updateHover(r),r.scrollIntoView();break;case"Enter":e.preventDefault(),t.click();break}}};window.customElements.define("searchable-select",o);})();
